<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Calculus of Divija | One Year</title>
    <!-- Fonts: JetBrains Mono for Math/Logic, Cinzel for Elegance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=JetBrains+Mono:wght@100;300&family=Montserrat:wght@300;500&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS VARIABLES & THEME --- */
        :root {
            --void: #030305;
            --stardust: #e0e0e0;
            --accent-math: #00f3ff; /* Cyan for Logic */
            --accent-love: #ff0055; /* Red for Passion */
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
        }

        /* --- RESET & BASE --- */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background-color: var(--void);
            color: var(--stardust);
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
            overflow-y: hidden; /* Locked until entry */
            height: 100vh;
            width: 100vw;
        }

        /* --- TYPOGRAPHY --- */
        h1, h2, h3 { font-family: 'Cinzel', serif; font-weight: 400; letter-spacing: 0.1em; }
        .code-font { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--accent-math); }
        .highlight { color: var(--accent-love); text-shadow: 0 0 10px rgba(255, 0, 85, 0.3); }
        .math-term { border-bottom: 1px dashed var(--accent-math); cursor: help; }

        /* --- LAYOUT UTILS --- */
        .full-screen { position: fixed; inset: 0; z-index: 10; display: flex; justify-content: center; align-items: center; }
        .hidden { opacity: 0; pointer-events: none; visibility: hidden; }
        
        /* --- CANVAS --- */
        #cosmos {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            /* Subtly pulse opacity via hardware accel */
            will-change: opacity;
        }

        /* --- ENTRY SCREEN --- */
        #entry-layer {
            background: var(--void);
            z-index: 100;
            transition: opacity 1.5s var(--ease-out-expo);
            flex-direction: column;
            gap: 2rem;
        }
        
        .loader-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            opacity: 0.7;
            min-height: 1.5em;
        }

        .enter-btn {
            padding: 1rem 3rem;
            background: transparent;
            border: 1px solid var(--accent-math);
            color: var(--accent-math);
            font-family: 'JetBrains Mono';
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.4s var(--ease-out-expo);
            position: relative;
            overflow: hidden;
        }
        
        .enter-btn:hover { background: rgba(0, 243, 255, 0.1); box-shadow: 0 0 20px rgba(0, 243, 255, 0.2); }

        /* --- MAIN CONTENT (SCROLLABLE) --- */
        #app-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 4rem 2rem;
            position: relative;
        }

        /* --- CONTENT BLOCKS --- */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            padding: 3rem;
            max-width: 800px;
            width: 90%;
            border-radius: 4px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            margin: 2rem 0;
        }

        /* --- PHOTO GRID (Handling Portrait vs Landscape) --- */
        .memory-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 250px 250px;
            gap: 20px;
            width: 100%;
            max-width: 900px;
            margin: 4rem auto;
        }

        /* K1 is Portrait: Spans 2 rows on the left */
        .photo-card.portrait {
            grid-column: 1;
            grid-row: 1 / span 2;
            height: 100%;
        }

        /* K2 & K3 are Landscape: Stacked on the right */
        .photo-card.landscape {
            grid-column: 2;
            height: 100%;
        }

        .photo-inner {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(80%) contrast(120%);
            transition: filter 0.5s ease, transform 0.5s ease;
            border: 1px solid var(--glass-border);
            background: #111; /* Placeholder color */
        }

        .photo-inner:hover {
            filter: grayscale(0%);
            transform: scale(1.02);
            z-index: 2;
            border-color: var(--accent-math);
        }

        /* --- AUDIO PLAYER --- */
        .audio-control {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 50;
            display: flex;
            align-items: center;
            gap: 1rem;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        .audio-control:hover { opacity: 1; }
        .bar-visualizer { display: flex; gap: 2px; height: 20px; align-items: flex-end; }
        .bar { width: 3px; background: var(--accent-math); height: 5px; }

        /* --- TEXT STYLING --- */
        p { line-height: 1.8; margin-bottom: 1.5rem; font-size: 1.1rem; }
        
        .equation-anim {
            font-family: 'JetBrains Mono';
            color: var(--accent-math);
            margin-bottom: 2rem;
            font-size: 0.8rem;
        }

        .signature-line {
            font-size: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-top: 3rem;
            color: var(--stardust);
        }

        .daddy-line {
            font-family: 'Cinzel';
            font-size: 1.2rem;
            margin-top: 2rem;
            padding: 1rem;
            border-left: 2px solid var(--accent-love);
            background: linear-gradient(90deg, rgba(255,0,85,0.05), transparent);
        }

        /* --- MOBILE ADAPTATION --- */
        @media (max-width: 768px) {
            .memory-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            .photo-card.portrait { grid-column: 1; aspect-ratio: 3/4; }
            .photo-card.landscape { grid-column: 1; aspect-ratio: 16/9; }
            .glass-panel { padding: 1.5rem; }
            h1 { font-size: 1.8rem; }
        }

        /* --- UTILITY CLASSES --- */
        .fade-up { opacity: 0; transform: translateY(30px); transition: all 1s var(--ease-out-expo); }
        .visible { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>

    <!-- 1. The Canvas: Mathematical Universe -->
    <canvas id="cosmos"></canvas>

    <!-- 2. Entry Overlay: The "Proof" -->
    <div id="entry-layer" class="full-screen">
        <div class="code-font" style="margin-bottom: 1rem;">// INITIALIZING VARIABLE: DIVIJA</div>
        <div id="scramble-target" class="loader-text">CALCULATING PROBABILITY...</div>
        <button id="start-btn" class="enter-btn hidden">Execute Journey</button>
    </div>

    <!-- 3. Audio Asset (Hidden) -->
    <audio id="bg-music" loop preload="auto">
        <source src="fallen-down.mp3" type="audio/mpeg">
    </audio>

    <!-- 4. Visualizer (Fixed UI) -->
    <div class="audio-control">
        <div class="code-font">1 YEAR.exe</div>
        <div id="visualizer" class="bar-visualizer"></div>
    </div>

    <!-- 5. Main Scrollable Content -->
    <div id="app-container">
        
        <!-- SECTION 1: THE HYPOTHESIS -->
        <section class="section">
            <div class="glass-panel fade-up">
                <div class="equation-anim">let t = 0; // The Beginning</div>
                <h1>The Divija <span class="highlight">Paradox</span></h1>
                <br>
                <p>
                    When we first collided, you were a jagged equation I couldn't solve. 
                    Sharp-tongued. Defensive. A "tough cookie" wrapped in layers of reinforced steel.
                </p>
                <p>
                    I was pissed. I thought, <em>"This variable is too volatile."</em>
                    I saw the rudeness and labeled it immaturity. I calculated the trajectory and saw a crash.
                </p>
                <p>
                    But I forgot the first rule of discovery: <span class="code-font">Never judge the data by the noise.</span>
                </p>
            </div>
        </section>

        <!-- SECTION 2: THE DISCOVERY (Photos) -->
        <section class="section">
            <div class="memory-grid fade-up">
                <!-- K1: Portrait (Left) -->
                <div class="photo-card portrait">
                    <img src="K1.png" alt="Divija Portrait" class="photo-inner" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzExMSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZmlsbD0iIzMzMyIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SzEgTk9UIEZPVU5EPC90ZXh0Pjwvc3ZnPg=='">
                </div>
                <!-- K2: Landscape (Top Right) -->
                <div class="photo-card landscape">
                    <img src="K2.png" alt="Memory Landscape 1" class="photo-inner" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzExMSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZmlsbD0iIzMzMyIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SzIgTk9UIEZPVU5EPC90ZXh0Pjwvc3ZnPg=='">
                </div>
                <!-- K3: Landscape (Bottom Right) -->
                <div class="photo-card landscape">
                    <img src="K3.png" alt="Memory Landscape 2" class="photo-inner" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzExMSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZmlsbD0iIzMzMyIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SzMgTk9UIEZPVU5EPC90ZXh0Pjwvc3ZnPg=='">
                </div>
            </div>
            <div class="glass-panel fade-up" style="margin-top: -2rem; z-index: 5;">
                <p>
                    I stayed. I observed. And the pattern emerged.
                    Under that independent armor lies a mind that dances with numbers and a heart that feels deeper than you let the world see.
                </p>
                <p class="code-font" style="text-align: center;">Result = Hidden Gem.</p>
            </div>
        </section>

        <!-- SECTION 3: THE CONSTANT (Poem & Message) -->
        <section class="section">
            <div class="glass-panel fade-up">
                <div class="equation-anim">Status: Maturity Reached</div>
                <h2>To The Girl <span class="highlight">Born of the Divine</span></h2>
                <br>
                <p>
                    <strong>Divija</strong>. Your name means heavenly born, yet you fight so hard to prove you are made of stone.
                </p>
                <p>
                    You look down at yourself, calculating your worth and finding remainders that don't exist.
                    But when I check your work, all I see is brilliance. 
                    I see the work ethic of a star burning to keep its system alive.
                </p>
                <p>
                    One year of solving this together.
                    From the chaos of our first meeting to the tranquility of now.
                    You have grown. You have matured.
                    My heart rests easy knowing the woman you are becoming.
                </p>
                <p>
                    You are my constant thought. My favorite variable. My beautiful proof.
                </p>

                <div class="daddy-line fade-up">
                    <span class="code-font">System Note:</span><br>
                    As much as you may hate to hear this: <br>
                    <span style="font-size: 1.4em; color: var(--accent-math); font-weight: bold;">I will always be DADDY</span>
                </div>

                <div class="signature-line">
                    I love you.
                </div>
            </div>
        </section>

        <!-- FOOTER SPACE -->
        <div style="height: 100px;"></div>
    </div>

<script>
/**
 * ARCHITECTURE: Functional Programming / Event-Driven
 * 1. MathUtils: Pure functions for calculations.
 * 2. AssetLoader: Promise-based lazy loading.
 * 3. ParticleSystem: Float32Array optimization for 60fps canvas.
 * 4. DOMManipulator: Side-effect management.
 */

// --- 1. MATHEMATICAL CORE (Pure) ---
const MathCore = {
    // Linear Interpolation
    lerp: (start, end, t) => start * (1 - t) + end * t,
    // Random Range
    random: (min, max) => Math.random() * (max - min) + min,
    // Map range
    map: (n, start1, stop1, start2, stop2) => 
        ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2
};

// --- 2. ASYNC ASSET MANAGEMENT (Robustness) ---
const AssetManager = (() => {
    const checkAudio = (id) => {
        const el = document.getElementById(id);
        return new Promise((resolve, reject) => {
            el.oncanplaythrough = () => resolve(true);
            el.onerror = () => {
                console.warn(`Audio ${id} failed. UX continuing without it.`);
                resolve(false); // Resolve false instead of reject to prevent crash
            };
            // Timeout fallback
            setTimeout(() => resolve(false), 3000);
        });
    };

    return {
        init: async () => {
            console.log("System: Checking Assets...");
            // We proceed even if audio fails, we just log it.
            await checkAudio('bg-music'); 
            return true; 
        }
    };
})();

// --- 3. HIGH PERFORMANCE VISUALS (The "Cosmos") ---
const Universe = (() => {
    const canvas = document.getElementById('cosmos');
    const ctx = canvas.getContext('2d', { alpha: false }); // Optimize: No alpha channel on bg
    
    let width, height;
    let particles; // Float32Array: [x, y, z, size, speed]
    const COUNT = 1000; 
    const PROP_COUNT = 5; // properties per particle

    const resize = () => {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        initParticles();
    };

    const initParticles = () => {
        particles = new Float32Array(COUNT * PROP_COUNT);
        for(let i = 0; i < COUNT; i++) {
            resetParticle(i, true);
        }
    };

    const resetParticle = (i, randomZ = false) => {
        const idx = i * PROP_COUNT;
        particles[idx] = (Math.random() - 0.5) * width;     // x
        particles[idx+1] = (Math.random() - 0.5) * height;  // y
        particles[idx+2] = randomZ ? Math.random() * width : width; // z (depth)
        particles[idx+3] = Math.random() * 2;               // size
        particles[idx+4] = MathCore.map(particles[idx+3], 0, 2, 0.5, 3); // speed based on size
    };

    const render = () => {
        // Clear with trail effect
        ctx.fillStyle = 'rgba(3, 3, 5, 0.4)'; 
        ctx.fillRect(0, 0, width, height);
        
        ctx.fillStyle = '#e2e2ff';
        
        const cx = width / 2;
        const cy = height / 2;

        for(let i = 0; i < COUNT; i++) {
            const idx = i * PROP_COUNT;
            
            // Update Z
            particles[idx+2] -= particles[idx+4]; // move closer

            // Reset if passed screen
            if(particles[idx+2] <= 1) {
                resetParticle(i, false);
            }

            // Project 3D to 2D
            const z = particles[idx+2];
            const perspective = 300 / z; // Focal length approximation
            const x = cx + particles[idx] * perspective;
            const y = cy + particles[idx+1] * perspective;
            const s = particles[idx+3] * perspective;

            // Draw
            if(x > 0 && x < width && y > 0 && y < height) {
                // Optimization: Draw rects instead of arcs (faster) for tiny stars
                ctx.fillRect(x, y, s, s);
            }
        }
        requestAnimationFrame(render);
    };

    return {
        start: () => {
            window.addEventListener('resize', resize);
            resize();
            render();
        }
    };
})();

// --- 4. SCRAMBLE TEXT EFFECT (Optimized) ---
const Scramble = (elementId, targetText, duration = 1500) => {
    const el = document.getElementById(elementId);
    if (!el) return;

    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()';
    const frames = 60;
    const steps = duration / (1000 / 60);
    let frame = 0;

    const anim = () => {
        const progress = frame / steps;
        const revealedCount = Math.floor(targetText.length * progress);
        
        let output = '';
        for(let i = 0; i < targetText.length; i++) {
            if (i < revealedCount) {
                output += targetText[i];
            } else {
                output += chars[Math.floor(Math.random() * chars.length)];
            }
        }
        
        el.innerText = output;
        frame++;
        
        if (frame <= steps) {
            requestAnimationFrame(anim);
        } else {
            el.innerText = targetText; // Ensure final state
            document.getElementById('start-btn').classList.remove('hidden');
        }
    };
    anim();
};

// --- 5. AUDIO VISUALIZER (Web Audio API) ---
const AudioEngine = (() => {
    let context, analyser, source;
    const bars = [];
    const container = document.getElementById('visualizer');

    const setupUI = () => {
        // Create 10 bars
        for(let i=0; i<8; i++) {
            const d = document.createElement('div');
            d.className = 'bar';
            container.appendChild(d);
            bars.push(d);
        }
    };

    const start = () => {
        const audio = document.getElementById('bg-music');
        
        // Attempt play
        audio.play().then(() => {
            // Init Web Audio
            context = new (window.AudioContext || window.webkitAudioContext)();
            analyser = context.createAnalyser();
            source = context.createMediaElementSource(audio);
            
            source.connect(analyser);
            analyser.connect(context.destination);
            
            analyser.fftSize = 32;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            const draw = () => {
                requestAnimationFrame(draw);
                analyser.getByteFrequencyData(dataArray);
                
                // Map low frequencies to bars
                for(let i=0; i<bars.length; i++) {
                    const val = dataArray[i]; // Low freqs are at start
                    const h = MathCore.map(val, 0, 255, 3, 20);
                    bars[i].style.height = `${h}px`;
                }
            };
            draw();
        }).catch(e => {
            console.log("Autoplay prevented or file missing. UI fallback.");
            container.style.opacity = 0; // Hide visualizer if no audio
        });
    };

    return { init: () => { setupUI(); }, play: start };
})();

// --- 6. INTERSECTION OBSERVER (Lazy Reveal) ---
const ObserverSystem = (() => {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.1 });

    return {
        observe: () => {
            document.querySelectorAll('.fade-up').forEach(el => observer.observe(el));
        }
    };
})();

// --- MAIN EXECUTION PIPELINE ---
window.onload = () => {
    // 1. Start Background immediately
    Universe.start();
    AudioEngine.init();

    // 2. Run Text Scramble "Loading" logic
    setTimeout(() => {
        Scramble('scramble-target', 'ACCESS GRANTED: DIVIJA');
    }, 500);

    // 3. User Interaction (Required for Audio context)
    document.getElementById('start-btn').addEventListener('click', () => {
        const overlay = document.getElementById('entry-layer');
        const main = document.getElementById('app-container');
        
        // Transition
        overlay.style.opacity = 0;
        
        setTimeout(() => {
            overlay.classList.add('hidden');
            document.body.style.overflowY = 'auto'; // Unlock scroll
            main.style.opacity = 1;
            
            // Start Systems
            AudioEngine.play();
            ObserverSystem.observe();
            
        }, 1500);
    });
};

</script>
</body>
</html>
