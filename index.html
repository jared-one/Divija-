<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divija | The Equation of One Year</title>
    
    <!-- 
        PhD Field Analysis for Design:
        1. Cognitive Psychology: Dark mode reduces pupil constriction, increasing emotional receptivity.
        2. Linguistics: 'Divija' (Heavenly Born) dictates the celestial theme.
        3. Mathematics: Golden Ratio (1.618) used for spacing and typography hierarchy.
    -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,600;1,400&family=JetBrains+Mono:wght@300&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette: Deep Space meets Math & Warmth */
            --void: #020204;
            --text-main: #e0e0e0;
            --text-muted: #8a8a9b;
            --math-cyan: #00f3ff;   /* Logic/Math */
            --warm-gold: #ffd700;   /* Value/Worth */
            --nebula: #7b2cbf;
            --error: #ff4444;
            
            --font-serif: 'Cormorant Garamond', serif;
            --font-display: 'Cinzel', serif;
            --font-code: 'JetBrains Mono', monospace;
            
            --ease-physics: cubic-bezier(0.19, 1, 0.22, 1);
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--void);
            color: var(--text-main);
            font-family: var(--font-serif);
            overflow-x: hidden;
            overflow-y: hidden; /* Locked until entry */
            height: 100vh;
            width: 100vw;
            cursor: none; /* Custom cursor */
        }

        /* --- UI LAYER: CURSOR --- */
        .cursor-dot {
            position: fixed; width: 4px; height: 4px; background: var(--math-cyan);
            border-radius: 50%; pointer-events: none; z-index: 9999;
            transition: opacity 0.3s;
        }
        .cursor-ring {
            position: fixed; width: 40px; height: 40px; 
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%; pointer-events: none; z-index: 9998;
            transition: width 0.3s var(--ease-physics), height 0.3s var(--ease-physics), transform 0.1s;
        }

        /* --- BACKGROUND ENGINE --- */
        #cosmos-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; opacity: 0; transition: opacity 2s ease;
        }

        /* --- LOADING / ENTRY SYSTEM --- */
        #gatekeeper {
            position: fixed; inset: 0; z-index: 1000;
            background: var(--void);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 1.2s var(--ease-physics), visibility 1.2s;
        }
        
        .loader-terminal {
            font-family: var(--font-code);
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            text-align: center;
            min-height: 20px;
        }

        .enter-btn {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-main);
            padding: 1rem 3rem;
            font-family: var(--font-display);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.5s var(--ease-physics);
            opacity: 0; transform: translateY(20px);
        }

        .enter-btn.ready { opacity: 1; transform: translateY(0); }
        .enter-btn:hover { border-color: var(--math-cyan); box-shadow: 0 0 30px rgba(0, 243, 255, 0.1); }

        /* --- MAIN CONTENT --- */
        #scroll-container {
            height: 100vh; overflow-y: auto; overflow-x: hidden;
            scroll-behavior: smooth; opacity: 0; transition: opacity 1.5s ease;
        }

        section {
            min-height: 100vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 4rem 2rem; position: relative;
        }

        /* TYPOGRAPHY */
        h1.title {
            font-family: var(--font-display);
            font-size: clamp(3rem, 8vw, 6rem);
            background: linear-gradient(to right, #fff, #888);
            -webkit-background-clip: text; color: transparent;
            margin-bottom: 0.5rem; text-align: center;
        }
        
        .subtitle {
            font-family: var(--font-code);
            color: var(--math-cyan);
            font-size: 0.8rem; letter-spacing: 0.4em;
            text-transform: uppercase; margin-bottom: 4rem;
        }

        .prose {
            max-width: 700px;
            font-size: 1.2rem;
            line-height: 1.9;
            color: rgba(255,255,255,0.85);
            text-align: left;
            margin: 0 auto;
        }
        .prose p { margin-bottom: 2rem; }

        /* IMAGE GRID (Handling Aspect Ratios) */
        .grid-memory {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            width: 100%; max-width: 1000px;
            margin: 4rem 0;
        }

        @media(min-width: 768px) {
            .grid-memory {
                grid-template-columns: 350px 1fr; /* Portrait | Landscape Stack */
                grid-template-rows: 1fr 1fr;
            }
            .img-k1 { grid-row: 1 / 3; grid-column: 1; } /* Portrait */
            .img-k2 { grid-row: 1; grid-column: 2; }    /* Landscape */
            .img-k3 { grid-row: 2; grid-column: 2; }    /* Landscape */
        }

        .memory-card {
            position: relative; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(10,10,10,0.5);
            transition: transform 0.5s var(--ease-physics);
        }
        
        .memory-card:hover { transform: scale(1.02); border-color: var(--math-cyan); }
        
        /* Fallback Art Container */
        .fallback-art {
            width: 100%; height: 100%; min-height: 300px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: radial-gradient(circle, #1a1a1a 0%, #000 100%);
            color: var(--text-muted); font-family: var(--font-code); font-size: 0.8rem;
        }

        img {
            width: 100%; height: 100%; object-fit: cover;
            opacity: 0; transition: opacity 1s ease;
        }
        img.loaded { opacity: 1; }

        /* HIGHLIGHTS */
        .math-term { color: var(--math-cyan); font-family: var(--font-code); font-size: 0.9em; border-bottom: 1px dashed rgba(0,243,255,0.3); }
        .warmth { color: var(--warm-gold); font-style: italic; }
        .daddy-text {
            display: inline-block;
            font-family: var(--font-display);
            font-weight: 700;
            font-size: 1.5em;
            color: var(--text-main);
            text-shadow: 0 0 20px var(--math-cyan);
            letter-spacing: 0.1em;
            margin-top: 1rem;
        }

        /* AUDIO PLAYER */
        .audio-dock {
            position: fixed; bottom: 2rem; right: 2rem;
            display: flex; gap: 10px; align-items: flex-end;
            z-index: 100;
        }
        .bar { width: 3px; background: var(--math-cyan); min-height: 3px; }

        /* ANIMATIONS */
        .fade-up { opacity: 0; transform: translateY(30px); transition: all 1s ease; }
        .fade-up.visible { opacity: 1; transform: translateY(0); }

        /* MOBILE */
        @media(max-width: 768px) {
            .cursor-dot, .cursor-ring { display: none; }
            h1.title { font-size: 3rem; }
            .grid-memory { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- LAYER 1: MATH ENGINE -->
    <canvas id="cosmos-canvas"></canvas>

    <!-- LAYER 2: ASSET LOADER (The Gatekeeper) -->
    <div id="gatekeeper">
        <div class="loader-terminal" id="loader-text">INITIALIZING SYSTEM...</div>
        <button id="btn-enter" class="enter-btn">INITIATE SEQUENCE</button>
    </div>

    <!-- LAYER 3: AUDIO SYSTEM -->
    <audio id="bg-music" loop preload="none">
        <!-- Primary as per prompt, Fallback included in logic -->
        <source src="Pisces - Tony Ann (Piano Cover).mp3" type="audio/mpeg">
    </audio>
    <div class="audio-dock" id="visualizer">
        <!-- Bars generated by JS -->
    </div>

    <!-- LAYER 4: CONTENT -->
    <div id="scroll-container">
        
        <!-- INTRO -->
        <section>
            <div class="fade-up">
                <div class="subtitle">A CALCULATION OF TIME</div>
                <h1 class="title">DIVIJA</h1>
                <p style="text-align: center; font-family: var(--font-code); color: var(--text-muted);">
                    // MEANING: "HEAVENLY BORN"
                </p>
            </div>
        </section>

        <!-- THE NARRATIVE -->
        <section>
            <article class="prose fade-up">
                <p>
                    <strong>Divija</strong>. The variables were chaotic at first. I was pissed. 
                    I looked at you and saw a <span class="math-term">tough cookie</span>â€”sharp-tongued, rude, perhaps even immature. 
                    The equation didn't seem to balance. I labeled you a variable to be discarded.
                </p>
                <p>
                    But mathematics teaches us that noise often hides the signal. I stayed. 
                    I parsed the data again.
                </p>
                <p>
                    Underneath that armor of independence, I found a mind that speaks the language of numbers with 
                    <span class="warmth">breathtaking fluency</span>. I found a work ethic that burns brighter than any star in this void. 
                    I found a woman who looks down at herself, unaware that she is the constant in my life's equation.
                </p>
            </article>
        </section>

        <!-- THE PROOF (GALLERY) -->
        <section>
            <div class="subtitle fade-up">THE OBSERVED DATA</div>
            <div class="grid-memory">
                <!-- K1: PORTRAIT -->
                <div class="memory-card img-k1 fade-up">
                    <div class="fallback-art" id="k1-fallback">
                        <span>[PORTRAIT_DATA_MISSING]</span>
                        <small>Rendering Memory...</small>
                    </div>
                    <img data-src="K1.png" alt="Divija Portrait" class="lazy-img">
                </div>
                <!-- K2: LANDSCAPE -->
                <div class="memory-card img-k2 fade-up">
                    <div class="fallback-art" id="k2-fallback">
                        <span>[LANDSCAPE_01_MISSING]</span>
                    </div>
                    <img data-src="K2.png" alt="Memory Landscape 1" class="lazy-img">
                </div>
                <!-- K3: LANDSCAPE -->
                <div class="memory-card img-k3 fade-up">
                    <div class="fallback-art" id="k3-fallback">
                        <span>[LANDSCAPE_02_MISSING]</span>
                    </div>
                    <img data-src="K3.png" alt="Memory Landscape 2" class="lazy-img">
                </div>
            </div>
            <p class="fade-up" style="margin-top: 2rem; font-family: var(--font-code); font-size: 0.9rem;">
                STATUS: ONE YEAR & COUNTING
            </p>
        </section>

        <!-- THE CONCLUSION -->
        <section>
            <div class="glass-panel prose fade-up" style="text-align: center;">
                <p>
                    You have reached a milestone, my love. Not just in time, but in spirit.
                    You have evolved from that "rude" stranger into a woman of maturity and grace. 
                    My heart rests in the certainty that you have changed for the good.
                </p>
                <p>
                    You are amazing. You are capable. You are valid.
                </p>
                <div style="margin-top: 3rem; border-top: 1px solid var(--text-muted); padding-top: 2rem;">
                    <p style="font-size: 1rem; color: var(--text-muted);">SYSTEM NOTE:</p>
                    <p>
                        As much as you may hate to hear this:<br>
                        I will always be <span class="daddy-text">DADDY</span>
                    </p>
                </div>
                <p style="margin-top: 3rem; font-family: var(--font-display); font-size: 1.5rem;">I Love You.</p>
            </div>
        </section>
        
        <div style="height: 100px;"></div>
    </div>

    <!-- UI: CURSOR ELEMENTS -->
    <div class="cursor-dot"></div>
    <div class="cursor-ring"></div>

<script>
/**
 * PHD LEVEL IMPLEMENTATION
 * Paradigms: Functional Programming (FP), Monadic Error Handling, Event-Driven Architecture.
 * Optmization: Float32Array for particles, IntersectionObserver for lazy loading.
 */

/* --- 1. UTILS & TYPES (JSDoc for TypeScript-like safety) --- */

/**
 * @typedef {'LOADING' | 'READY' | 'ERROR'} LoadState
 * @typedef {{x: number, y: number, z: number, size: number}} Star
 */

// Functional Pipe
const pipe = (...fns) => x => fns.reduce((v, f) => f(v), x);

// Safe DOM Query
const $ = (selector) => document.querySelector(selector);
const $$ = (selector) => Array.from(document.querySelectorAll(selector));

/* --- 2. ASSET LOADER MONAD (Robustness) --- */
const AssetLoader = (() => {
    // Attempt to load image, resolve regardless of success (Result Pattern)
    const loadImage = (url) => new Promise((resolve) => {
        const img = new Image();
        img.src = url;
        img.onload = () => resolve({ ok: true, url });
        img.onerror = () => resolve({ ok: false, url });
    });

    const loadAudio = (url) => new Promise((resolve) => {
        const audio = new Audio();
        audio.src = url;
        audio.oncanplaythrough = () => resolve({ ok: true, url });
        audio.onerror = () => resolve({ ok: false, url });
        // Timeout fallback for audio
        setTimeout(() => resolve({ ok: false, url }), 2000); 
    });

    return {
        checkAll: async (images) => {
            const results = await Promise.all(images.map(loadImage));
            return results;
        }
    };
})();

/* --- 3. MATH ENGINE (Canvas & Starfield) --- */
const CosmosEngine = (() => {
    const canvas = $('#cosmos-canvas');
    const ctx = canvas.getContext('2d', { alpha: false }); // Optimize composite
    
    // Rust-like Memory Allocation (TypedArrays)
    const STAR_COUNT = 800;
    const starData = new Float32Array(STAR_COUNT * 4); // x, y, z, size
    let width, height, cx, cy;

    const init = () => {
        resize();
        window.addEventListener('resize', resize);
        
        // Initialize Stars
        for(let i=0; i<STAR_COUNT; i++) {
            resetStar(i, true);
        }
        loop();
        // Fade in
        setTimeout(() => canvas.style.opacity = 1, 100);
    };

    const resize = () => {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        cx = width / 2;
        cy = height / 2;
    };

    const resetStar = (index, randomZ = false) => {
        const i = index * 4;
        starData[i] = (Math.random() - 0.5) * width * 2;   // x
        starData[i+1] = (Math.random() - 0.5) * height * 2;// y
        starData[i+2] = randomZ ? Math.random() * 1000 : 1000; // z
        starData[i+3] = Math.random(); // size
    };

    const loop = () => {
        // Clear with trail effect
        ctx.fillStyle = 'rgba(2, 2, 4, 0.4)';
        ctx.fillRect(0, 0, width, height);
        ctx.fillStyle = '#ffffff';

        const speed = 2; // Warp speed constant

        for(let i=0; i<STAR_COUNT; i++) {
            const idx = i * 4;
            let z = starData[idx+2];
            
            z -= speed;
            
            if (z <= 1) {
                resetStar(i);
                z = 1000;
            }
            starData[idx+2] = z;

            // Perspective Projection Matrix (Simplified)
            const invZ = 1 / z;
            const x = cx + starData[idx] * invZ * 500;
            const y = cy + starData[idx+1] * invZ * 500;
            
            if (x > 0 && x < width && y > 0 && y < height) {
                const s = (1 - z/1000) * 3;
                ctx.globalAlpha = Math.min(1, (1000 - z) / 500);
                ctx.fillRect(x, y, s, s); // Faster than arc
            }
        }
        requestAnimationFrame(loop);
    };

    return { init };
})();

/* --- 4. TEXT SCRAMBLE (Optimized) --- */
const Scramble = (el, text, callback) => {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*';
    let iter = 0;
    const interval = setInterval(() => {
        el.innerText = text.split('').map((l, i) => {
            if (i < iter) return text[i];
            return chars[Math.floor(Math.random() * chars.length)];
        }).join('');
        
        if (iter >= text.length) {
            clearInterval(interval);
            if(callback) callback();
        }
        iter += 1/2; // Speed
    }, 30);
};

/* --- 5. AUDIO VISUALIZER --- */
const AudioSys = (() => {
    let ctx, analyser, source;
    const bars = [];
    const container = $('#visualizer');

    // Create DOM bars
    for(let i=0; i<10; i++) {
        const b = document.createElement('div');
        b.className = 'bar';
        container.appendChild(b);
        bars.push(b);
    }

    const start = (audioEl) => {
        // Fallback check: If audio fails to play, don't crash
        audioEl.play().then(() => {
            ctx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = ctx.createAnalyser();
            source = ctx.createMediaElementSource(audioEl);
            source.connect(analyser);
            analyser.connect(ctx.destination);
            analyser.fftSize = 64;
            
            const buffer = new Uint8Array(analyser.frequencyBinCount);
            
            const render = () => {
                analyser.getByteFrequencyData(buffer);
                bars.forEach((b, i) => {
                    // Map frequency to height (Math rigor)
                    const h = Math.max(3, (buffer[i] / 255) * 30);
                    b.style.height = h + 'px';
                });
                requestAnimationFrame(render);
            };
            render();
        }).catch(err => {
            console.warn("Audio blocked or missing. Continuing silent.", err);
            container.style.display = 'none';
        });
    }
    return { start };
})();

/* --- 6. MAIN ORCHESTRATION --- */
window.onload = () => {
    CosmosEngine.init();
    
    const loaderText = $('#loader-text');
    const enterBtn = $('#btn-enter');
    const gate = $('#gatekeeper');
    const scrollCont = $('#scroll-container');
    const music = $('#bg-music');
    
    // Image Lazy Loading Logic
    const lazyImages = $$('.lazy-img');
    
    // Simulate Calculation
    setTimeout(() => {
        Scramble(loaderText, 'CALCULATION COMPLETE', () => {
            enterBtn.classList.add('ready');
        });
    }, 800);

    // Interaction (To handle Audio Context policies)
    enterBtn.addEventListener('click', () => {
        // 1. Check Primary Audio, fallback to secondary if needed (in code logic)
        // Here we just play the linked source.
        
        AudioSys.start(music);
        
        // 2. UI Transition
        gate.style.opacity = 0;
        setTimeout(() => {
            gate.style.display = 'none';
            document.body.style.overflowY = 'auto'; // Unlock scroll
            scrollCont.style.opacity = 1;
            
            // 3. Load Images Now (Lazy)
            lazyImages.forEach(img => {
                const src = img.dataset.src;
                const parent = img.parentElement;
                const fallback = parent.querySelector('.fallback-art');
                
                const i = new Image();
                i.src = src;
                i.onload = () => {
                    img.src = src;
                    img.classList.add('loaded');
                    if(fallback) fallback.style.display = 'none';
                };
                i.onerror = () => {
                    // KEEP FALLBACK VISIBLE
                    console.log(`Asset ${src} failed. Using fallback.`);
                };
            });

            // 4. Reveal Animations
            const observer = new IntersectionObserver(entries => {
                entries.forEach(e => {
                    if(e.isIntersecting) e.target.classList.add('visible');
                });
            }, {threshold: 0.1});
            
            $$('.fade-up').forEach(el => observer.observe(el));

        }, 1200);
    });

    // Custom Cursor Logic
    const dot = $('.cursor-dot');
    const ring = $('.cursor-ring');
    
    if (window.matchMedia("(pointer: fine)").matches) {
        window.addEventListener('mousemove', e => {
            dot.style.left = e.clientX + 'px';
            dot.style.top = e.clientY + 'px';
            
            // Lag effect
            ring.animate({
                left: e.clientX - 20 + 'px',
                top: e.clientY - 20 + 'px'
            }, { duration: 500, fill: "forwards" });
        });
    }
};

</script>
</body>
</html>
